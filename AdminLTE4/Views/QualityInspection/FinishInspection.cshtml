@{
	ViewData["Title"] = "Final Inspection";
}

<link rel="stylesheet" href="~/css/FinishInspection.css" asp-append-version="true" />


@await Html.PartialAsync("_FinishInspectionTab")
@await Html.PartialAsync("_ModalUpdateFILog")



	<div class="col-md-4" style="display:none!important;">
		<div class="card" >
			<div class="card-body" >
				<div class="row mt-2" >
					<div class="col form-check form-check-inline">
						<input type="radio" name="name" value="" />
						<label>Fresh</label>
					</div>
					<div class="col form-check form-check-inline">
						<input type="radio" name="name" value="" />
						<label>Re-print</label>
					</div>
				</div>
				<div class="mt-3 d-grid align-items-center">
					<p>Please input below textbox and then press enter</p>
					<input class=" form-control form-control-lg" type="text" name="name" value="" />
				</div>
			</div>
		</div>
	</div>


			<div class="card">
				<div class="card-header">

					<div class="d-flex align-items-center gap-3 flex-wrap">

						<!-- Input textbox -->
						<div class="d-flex flex-column justify-content-center">
							<label class="form-label mb-1">Input & Press Enter</label>
							<input class="form-control form-control-sm" type="text" name="nameInput" style="width: 200px;" />
						</div>
						<!-- Radio: Fresh -->
						<div class="form-check form-check-inline m-0">
							<input class="form-check-input" type="radio" name="name" id="freshOption" value="fresh" />
							<label class="form-check-label" for="freshOption">Fresh</label>
						</div>
						<!-- Radio: Re-print -->
						<div class="form-check form-check-inline m-0">
							<input class="form-check-input" type="radio" name="name" id="reprintOption" value="reprint" />
							<label class="form-check-label" for="reprintOption">Re-print</label>
						</div>

					</div>
				</div>
				<div class="card-body">


				<div class="table-responsive">

					<table id="DMSFILog" class="display table table-bordered table-striped table-hover" style="width:100%">
							<thead class="table-secondary align-middle text-center text-nowrap">
								<tr>
									<th>Doc #</th>
									<th>Order #</th>
									<th>Part #</th>
									<th>Description</th>
									<th>Batch #</th>
									<th>Qty</th>
									<th>Operation</th>
									<th>Start Date</th>
									<th>Start Time</th>
									<th>Cell</th>
									<th>Concession</th>
									<th>Prod Permit</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody class="align-middle text-center text-nowrap">

							</tbody>
					</table>
				</div>
	

				</div>
			</div>
<div class="row mt-3 d-flex" style="display: none!important;">
			<div class="col">
			<div class="card">
				<div class="card-header">
					<h3 class="mb-4">Details</h3>
					<div class="btn-group d-flex gap-3 mb-1">
						<button class="btn btn-secondary">SAVE</button>
						<button class="btn btn-secondary">CLEAR</button>
						<button class="btn btn-secondary">DELETE</button>
						<button class="btn btn-secondary">HOLD</button>
						<button class="btn btn-secondary">PRINT</button>
					</div>
				</div>
				<div class="card-body">
					<div class="d-grid gap-3 p-2">
						<div class="row mb-1">
							<label class="col text-end">Order Number :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
							<label class="col text-end">Doc Number :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1">
							<label class="col-md-3 text-end">Part Number :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1">
							<label class="col-md-3 text-end">Description :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">Batch Number :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">Operation# :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">Cell :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">*Job Type :</label>
							<select class="col form-select form-select-sm" id="inputGroupSelect01">
								<option selected>Choose...</option>
								<option value="1">One</option>
								<option value="2">Two</option>
								<option value="3">Three</option>
							</select>
						</div>
						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">*DWG.Rev (APPM) :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">Concession :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>

						<div class="card-body align-items-center justify-content-center border rounded p-4">
							<div class="row mb-4">
								<label class="col-md-3 text-end">Prod Permit :</label>
								<input class="col form-control form-control-sm" type="text" name="name" value="" />
							</div>
							<div class="row mb-1 align-items-center justify-content-center">
								<div class="col-md-3"></div>
								<label class="col-md-2 text-end">Valid till :</label>
								<input class="col form-control form-control-sm" type="text" name="name" value="" />
								<label class="col-md-2 text-end">Remain Qty :</label>
								<input class="col form-control form-control-sm" type="text" name="name" value="" />
							</div>
						</div>

						<div class="row mb-1 align-items-center justify-content-center">
							<label class="col-md-3 text-end">Order Status :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
					</div>
				</div>
			</div>
		</div>

			<div class="col">
				<div class="card">
				<div class="card-header">
					<h3>Alert</h3>
					<div class="btn-group-lg text-center">
						<button class="btn">KFR</button>
						<button class="btn">Concession</button>
						<button class="btn">Production Permit</button>
					</div>
					<div class="btn-group-lg text-center">
						<button class="btn">Special Process</button>
						<button class="btn">Tag Label</button>
					</div>
				</div>
					<div class="card-body">
					<div class="d-grid gap-3 p-2">
						<div class="row align-items-center gap-2">
							<label class="col-md-3 text-end">Start Date :</label>
							<input class="col form-control form-control-sm" type="date" name="name" value="" />
							<input class="col form-control form-control-sm" type="date" name="name" value="" />
							<div class="col-md-1"></div>
						</div>
						<div class="row gap-2">
							<label class="col-md-3 text-end">Finish Date :</label>
							<input class="col form-control form-control-sm" type="date" name="name" value="" />
							<input class="col form-control form-control-sm" type="date" name="name" value="" />
							<button class="col-md-1 btn btn-outline-secondary">
								<i class="bi bi-arrow-clockwise"></i>
							</button>
						</div>
						<div class="row gap-2">
							<label class="col-md-3 text-end">Week :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row gap-2">
							<label class="col-md-3 text-end">Labor Time :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row gap-2">
							<label class="col-md-3 text-end">*Employee # :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row gap-2">
							<label class="col-md-3 text-end">KFR : </label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row gap-2">
							<label class="col-md-3 text-end">ON Number :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row d-flex gap-2">
							<label class="col-md-3 text-end">*Serial # :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
							<button class="col-md-1 btn btn-outline-secondary align-items-center">
								<i class="bi bi-trash"></i>
							</button>
						</div>
						<div class="row justify-content-end d-flex gap-2">
							<div class="col-md-3"></div>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
							<div class="col-md-1"></div>
						</div>
						<div class="row d-flex gap-2">
							<label class="col-md-3 text-end">Remarks :</label>
							<input class="col form-control form-control-sm" type="text" name="name" value="" />
						</div>
						<div class="row justify-content-end">
							<button class="col-md-auto btn btn-secondary">PRINT</button>
						</div>
					</div>
				</div>
				</div>
			</div>

			<div class="col-3">
			<div class="card">
				<h2 class="card-header">Quantity</h2>
				<div class="card-body gap-3">
					<div class="d-grid gap-2 p-2">
						<div class="row mb-2">
							<label class="col">Quantity :</label>
							<input readonly class="col form-control" type="text" name="name" value="" />
						</div>
						<div class="row mb-2">
							<label class="col">Accepted :</label>
							<input class="col form-control" type="text" name="name" value="" />
						</div>
						<div class="row mb-2">
							<label class="col">Rejected :</label>
							<input class="col form-control" type="text" name="name" value="" />
						</div>
					</div>
				</div>
			</div>
		</div>

		</div>


				<div class="card mt-3">
					<h2 class="card-header">Item Checklist </h2>
					<div class="card-body gap-3">
						<div class="row" >
							<div class="col gap-3" >
								<div class="mb-3">
									<p>Visual surface on part inspection : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Material number engrave on the parts : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Visual surface on part inspection : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>

									</div>

								</div>
								<div class="mb-3">
									<p>Unified thread symbol'000' engraved : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Prod. permit/concession number engraved on the parts correctly and clearly : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								</div>
							<div class="col">
								<div class="mb-3">
									<p>Assembly configuration OK : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Part and document inspection : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Order and batch number on the part are comply with the document : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Actual part qty are comply with qty in the document accordign to last procesess : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
								<div class="mb-3">
									<p>Update data on SAP Systems : </p>
									<div class="input-group gap-3">
										<div>
											<input type="radio" name="name" value="" />
											<label>Yes</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>No</label>
										</div>
										<div>
											<input type="radio" name="name" value="" />
											<label>N/A</label>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-auto" >
								<button class="btn btn-outline-secondary" >
									<i class="bi bi-printer"></i>
								</button>
							</div>
						</div>
					</div>
				</div>

@section Scripts{
	<script>
		$(document).ready(function () {
			
			var table = $('#DMSFILog').DataTable({

				scrollX: true, // Aktifkan scroll horizontal
				autoWidth: false,
				responsive: false,
				fixedHeader: true,

				ajax: {
					url: '/QualityInspectionApi/GetDataByUser',
					type: 'GET',
					dataSrc: 'data'
				},
				columns: [
					{ data: 'doc_Number', className: 'text-center' },
					{ data: 'order_Number',className: 'text-center' },
					{ data: 'part_Number',className: 'text-center' },
					{ data: 'description',className: 'text-center' },
					{ data: 'batch_Number',className: 'text-center' },
					{ data: 'qty',className: 'text-center' },
					{ data: 'operation',className: 'text-center' },
					{ data: 'start_Date',className: 'text-center' },
					{ data : 'start_Time',className: 'text-center'},
					{ data: 'cell',className: 'text-center' },
					{ data: 'concession',className: 'text-center' },
					{ data: 'production_Permit',className: 'text-center' },
					{
						data: 'id', className: 'text-center',
						render: function (data, type, row) {
						return `
						<div class="d-flex gap-2 align-item-center justify-content-center ">

							<button class="btn btn-sm btn-outline-warning btn-edit mr-3"
									data-id="${data}"
									data-doc="${row.doc_Number}"
									data-order="${row.order_Number}"
									data-part="${row.part_Number }"
									data-description="${row.description }"
									data-drawing="${row.drawing_Rev }"
									data-batch="${row.batch_Number  }"
									data-qty="${row.qty }"
									data-acc="${row.acc }"
									data-rejected="${row.rejected }"
									data-job="${row.job_Type }"
									data-operation="${row.operation }"
									data-startdate="${row.start_Date }"
									data-starttime="${row.start_Time }"
									data-enddate="${row.end_Date }"
									data-endtime="${row.end_Time }"
									data-labor="${row.labor }"
									data-week="${row.week  }"
									data-eid="${row.eid }"
									data-name="${row.name }"
									data-price="${row.std_Price }"
									data-cell="${row.cell }"
									data-qn="${row.qn }"
									data-kfr="${row.kfr  }"
									data-concession="${row.concession}"
									data-permit="${row.production_Permit }"
									data-serial="${row.serial_Number }"
									data-remarks="${row.remarks }"
									data-status="${row.status }">
								<i class="bi bi-pencil-square"></i> Edit
							</button>
							<button class="btn btn-sm btn-outline-danger btn-delete" data-id="${data}">
								<i class="bi bi-trash3-fill"></i> Delete
							</button>
						</div>
						`;
					},
					orderable: false,
					searchable: false
				
					}
			],
			initComplete: function () {
				// Tambahkan margin bawah pada input search
				$('#DMSFILog_filter').addClass('mb-3');
			}
		});
			$(window).on('resize', function () {
				table.columns.adjust().draw();
			});

			// Tampilkan modal & isi data
			$('#DMSFILog').on('click', '.btn-edit', function () {

				$('#edit-id').val($(this).data('id'));
				$('#edit-doc').val($(this).data('doc'));
				$('#edit-order').val($(this).data('order'));
				$('#edit-part').val($(this).data('part'));
				$('#edit-description').val($(this).data('description'));
				$('#edit-drawing').val($(this).data('drawing'));
				$('#edit-batch').val($(this).data('batch'));
				$('#edit-qty').val($(this).data('qty'));
				$('#edit-acc').val($(this).data('acc'));
				$('#edit-rejected').val($(this).data('rejected'));
				$('#edit-job').val($(this).data('job'));
				$('#edit-operation').val($(this).data('operation'));

				$('#edit-startdate').val($(this).data('startdate')?.split('T')[0]);
				//$('#edit-starttime').val($(this).data('starttime'));

				$('#edit-starttime').val($(this).data('starttime')?.substring(0,5));

				$('#edit-enddate').val($(this).data('enddate')?.split('T')[0]);

				//$('#edit-endtime').val($(this).data('endtime'));
				$('#edit-endtime').val($(this).data('endtime')?.substring(0,5));


				$('#edit-labor').val($(this).data('labor'));
				$('#edit-week').val($(this).data('week'));
				$('#edit-eid').val($(this).data('eid'));
				$('#edit-name').val($(this).data('name'));
				$('#edit-price').val($(this).data('price'));
				$('#edit-cell').val($(this).data('cell'));
				$('#edit-qn').val($(this).data('qn'));
				$('#edit-kfr').val($(this).data('kfr'));
				$('#edit-concession').val($(this).data('concession'));

				// Ambil data permit dan pecah jadi array
				let permitsRaw = $(this).data('permit');
				let permits = Array.isArray(permitsRaw)
					? permitsRaw
					: String(permitsRaw).split(',').map(x => x.trim());

				// Kosongkan container permit
				$('#edit-permit-group').empty();

				const partNumber = $('#edit-part').val()?.trim();

				if (partNumber && partNumber.toLowerCase() !== "n/a") {
					$.ajax({
						url: `/QualityInspectionApi/GetValidTillByPart/${encodeURIComponent(partNumber)}`,
						method: 'GET',
						success: function (data) {
							if (Array.isArray(data) && data.length > 0) {
								data.forEach((permit, index) => {
									const baseId = `permit-${index}`;
									const validTill = permit.end_Date?.split('T')[0] ?? '';
									const remainingQty = permit.remaining_Qty ?? 0;
									const permitNumber = permit.production_Permit ?? '';

									const $container = $(`
										<div class="border rounded p-3 mb-3" id="${baseId}-container">
											<div class="d-flex align-items-center justify-content-end mb-3">
												<label class="form-label me-2 text-end" style="width: 100px;">
													Prod. Permit :
												</label>
												<input 
													type="text" 
													class="form-control text-center"
													style="width: 300px;"
													readonly 
													name="edit-permit[]" 
													value="${permitNumber}" />
											</div>
											<div class="row mb-3 border-top pt-3">
												<div class="col-md-3"></div>
												<div class="col-md-9">
													<div class="d-flex flex-wrap align-items-center gap-3 justify-content-end">
														<div class="d-flex align-items-center gap-2 mb-2 mb-0">
															<label class="form-label" style="white-space: nowrap;">
																Valid Till :
															</label>
															<input
																type="date" 
																class="form-control text-center me-2" 
																style="width: 100px;"
																name="edit-permit-valid[]"
																value="${validTill}" />
														</div>
														<div class="d-flex align-items-center gap-2 mb-2 mb-0">
															<label class="form-label" style="white-space: nowrap;">
																Remaining Qty :
															</label>
															<input 
																type="text" 
																class="form-control text-center me-2" 
																style="width: 50px;"
																name="edit-permit-qty[]"
																value="${remainingQty}" />
														</div>
													</div>
												</div>
											</div>
										</div>
									`);

									$('#edit-permit-group').append($container);
								});
							} else {
								console.warn(`Data untuk part number '${partNumber}' tidak ditemukan.`);
							}
						},
						error: function () {
							console.warn(`Gagal memuat data permit untuk part number '${partNumber}'.`);
						}
					});
				}

				
				// $('#edit-permit').val($(this).data('permit'));
				$('#edit-serial').val($(this).data('serial'));
				$('#edit-remarks').val($(this).data('remarks'));
				$('#edit-status').val($(this).data('status'));

				const modal = new bootstrap.Modal(document.getElementById('editModalFi'));
				modal.show();

				$.ajax({
					url: `/QualityInspectionApi/GetAlertByPart/${partNumber}`,
					type: 'GET',
					success: function (data) {
						const item = data[0] || {};

						const concession = item.isConcession?.trim().toLowerCase();
						const permit = item.isProduction?.trim().toLowerCase();
						const kfr = item.isKFRActive;
						const tag = item.isTagLabel;
						const route = item.routing_Operation;

						// KFR
						if (kfr) {
							$('#alert-kfr')
								.removeClass('alert-secondary')
								.addClass('bg-warning');
							$('#alert-kfr i')
								.removeClass('text-secondary')
								.addClass('text-success');
						} else {
							$('#alert-kfr')
								.removeClass('bg-warning')
								.addClass('alert-secondary');
							$('#alert-kfr i')
								.removeClass('text-success')
								.addClass('text-secondary');
						}

						// Concession
						if (concession && concession  !== 'n/a') {
							$('#alert-concession')
								.removeClass('alert-secondary')
								.addClass('bg-warning');
							$('#alert-concession i')
								.removeClass('text-secondary')
								.addClass('text-success');
						} else {
							$('#alert-concession')
								.removeClass('bg-warning')
								.addClass('alert-secondary');
							$('#alert-concession i')
								.removeClass('text-success')
								.addClass('text-secondary');
						}

						// Production Permit
						if (permit && permit !== '' && permit !== 'n/a') {
							$('#alert-prodpermit')
								.removeClass('alert-secondary')
								.addClass('bg-warning');
							$('#alert-prodpermit i')
								.removeClass('text-secondary')
								.addClass('text-success');
						} else {
							$('#alert-prodpermit')
								.removeClass('bg-warning')
								.addClass('alert-secondary');
							$('#alert-prodpermit i')
								.removeClass('text-success')
								.addClass('text-secondary');
						}


						// Tag Label
						if (tag && tag.toLowerCase()=== "yes" && tag !== "N/A") {
							$('#alert-tag')
								.removeClass('alert-secondary')
								.addClass('bg-warning');
							$('#alert-tag i')
								.removeClass('text-secondary')
								.addClass('text-success');
						} else {
							$('#alert-tag')
								.removeClass('bg-warning')
								.addClass('alert-secondary');
							$('#alert-tag i')
								.removeClass('text-success')
								.addClass('text-secondary');
						}

						// Special Process (Routing)
						if (route) {
							$('#alert-sp')
								.removeClass('alert-secondary')
								.addClass('bg-warning');
							$('#alert-sp i')
								.removeClass('text-secondary')
								.addClass('text-success');
						} else {
							$('#alert-sp')
								.removeClass('bg-warning')
								.addClass('alert-secondary');
							$('#alert-sp i')
								.removeClass('text-success')
								.addClass('text-secondary');
						}

						console.log(data);
					},
					error: function (xhr) {
						$('#alertModalBody').html(`<p class="text-danger">${xhr.responseText || "Something went wrong."}</p>`);
						$('#alertModal').modal('show');
					}
				});








			});

			  // Submit Edit Form via AJAX
			$('#editForm').submit(function (e) {
				e.preventDefault();

				const id = $('#edit-id').val();
				const permits = [];
					$('input[name="edit-permit[]"]').each(function () {
						permits.push($(this).val());
					});
				const data = {
					id: id,
					doc_Number: $('#edit-doc').val(),
					order_Number: $('#edit-order').val(),
					part_Number: $('#edit-part').val(),
					description: $('#edit-description').val(),
					drawing_Rev:$('#edit-drawing').val(),
					batch_Number:$('#edit-batch').val(),
					qty:$('#edit-qty').val(),
					acc:$('#edit-acc').val(),
					rejected:$('#edit-rejected').val(),
					job_Type:$('#edit-job').val(),
					operation:$('#edit-operation').val(),
					start_Date:$('#edit-startdate').val(),
					//start_Time:$('#edit-starttime').val(),
					end_Date:$('#edit-enddate').val(),
					start_Time: $('#edit-starttime').val() ? $('#edit-starttime').val() + ':00' : null,
					end_Time: $('#edit-endtime').val() ? $('#edit-endtime').val() + ':00' : null,
					//end_Time:$('#edit-endtime').val(),
					labor:$('#edit-labor').val(),
					week:$('#edit-week').val(),
					eid:$('#edit-eid').val(),
					name:$('#edit-name').val(),
					std_Price:$('#edit-price').val(),
					cell:$('#edit-cell').val(),
					qn:$('#edit-qn').val(),
					kfr:$('#edit-kfr').val(),
					concession: $('#edit-concession').val(),
					production_Permit:permits.join(','),
					serial_Number:$('#edit-serial').val(),
					remarks:$('#edit-remarks').val(),
					status:$('#edit-status').val()
				};

				console.log("Data yang dikirim:", data);



				const $btn = $('#btnSave');
				const $spinner = $btn.find('.spinner-border');
				const $label = $btn.find('.btn-label');

				$spinner.removeClass('d-none');
				$label.text('Saving...');
				$btn.prop('disabled', true);


				$.ajax({
					url: `/QualityInspectionApi/SaveFinish/${id}`,
					type: 'PUT',
					contentType: 'application/json',
					data: JSON.stringify(data),
					success: function () {
						$spinner.addClass('d-none');
						$label.html('<i class="bi bi-save me-1"></i> SAVE');
						$btn.prop('disabled', false);
						$('#editModalFi').modal('hide');
						Swal.fire({
							icon: 'success',
							title: 'Berhasil!',
							text: 'Data berhasil diperbaharui.',
						});
						table.ajax.reload();
					},
					error: function () {
						$spinner.addClass('d-none');
						$label.html('<i class="bi bi-save me-1"></i> SAVE');
						$btn.prop('disabled', false);
						Swal.fire({
							icon: 'error',
							title: 'Gagal!',
							text: 'Gagal menyimpan data.',
						});
					}
				});
			});

			 $('#DMSFILog').on('click', '.btn-delete', function () {
					const id = $(this).data('id');

					// Menggunakan SweetAlert untuk konfirmasi
					Swal.fire({
						title: 'Apakah kamu yakin?',
						text: "Data ini akan dihapus permanen!",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: 'Ya, hapus!',
						cancelButtonText: 'Batal',
						reverseButtons: true
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								url: `/QualityInspectionApi/DeleteData/${id}`,
								type: 'DELETE',
								success: function () {
									Swal.fire({
										icon: 'success',
										title: 'Berhasil!',
										text: 'Data berhasil dihapus.',
									});
									table.ajax.reload();  // Reload tabel setelah data dihapus
								},
								error: function () {
									Swal.fire({
										icon: 'error',
										title: 'Gagal!',
										text: 'Gagal menghapus data.',
									});
								}
							});
						} else {
							Swal.fire({
								icon: 'info',
								title: 'Dibatalkan',
								text: 'Penghapusan data dibatalkan.',
							});
						}
					});
				});



		});

	</script>

}